!function(){"use strict";var e={n:function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,{a:r}),r},d:function(t,r){for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.apiFetch,r=e.n(t);window.wp.url;const o=async(e,t)=>{const{openai_key:r}=t;try{console.log("Starting alt text generation for image:",e);const t=await(async e=>{try{const t=await fetch(e),r=await t.blob();return new Promise((e,t)=>{const o=new FileReader;o.onloadend=()=>e(o.result),o.onerror=t,o.readAsDataURL(r)})}catch(e){throw console.error("Error converting image to base64:",e),e}})(e);console.log("Successfully converted image to base64");const o="Create a SEO optimized alt text for this image. Don't include quotes and keep it informative and concise.";console.log("Sending request to OpenAI API...");const n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-4o-mini",max_tokens:100,messages:[{role:"user",content:[{type:"text",text:o},{type:"image_url",image_url:{url:t}}]}]})});if(!n.ok){const e=await n.json();throw new Error(`OpenAI API error: ${e.error?.message||"Unknown error"}`)}const s=await n.json();if(console.log("OpenAI API response:",s),!s.choices||!s.choices[0]||!s.choices[0].message)throw new Error("Invalid response from OpenAI API");const a=s.choices[0].message.content.trim();return console.log("Generated alt text:",a),a}catch(e){throw console.error("Error generating alt text:",e),console.error("Error details:",{message:e.message,stack:e.stack,response:e.response}),e}};var n=window.ReactJSXRuntime;const{createHigherOrderComponent:s}=wp.compose,{Fragment:a,useState:c,useEffect:i}=wp.element,{PanelBody:l,Button:g}=wp.components,{InspectorControls:p}=wp.blockEditor,d=({BlockEdit:e,props:t})=>{const[s,d]=c({}),[u,h]=c(""),[m,w]=c(!1);return i(()=>{(async()=>{try{const e=await(async()=>{try{return await r()({path:"/ai-alt-text-generator/v1/settings",method:"GET"})||{}}catch(e){return console.error("fetchSettings Errors:",e),{ai_alt_text_generator_options_fetch_settings_errors:!0}}})();d(e)}catch(e){console.error("Error fetching settings:",e)}})()},[]),(0,n.jsxs)(a,{children:[(0,n.jsx)(e,{...t}),"core/image"===t.name&&(0,n.jsx)(p,{children:(0,n.jsxs)(l,{title:"Generate Alt Text",children:[(0,n.jsx)(g,{isSecondary:!0,onClick:async()=>{const{attributes:e,setAttributes:r}=t,{url:n}=e;h("Generating alt text..."),w(!1);try{r({alt:await o(n,s)}),h("Alt text generated successfully!"),w(!0)}catch(e){console.error("Error generating alt text:",e),h("Error generating alt text."),w(!1)}},children:"Generate Alt Text"}),u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("p",{style:{color:m?"#00a32a":"#cc1818"},children:u})]})]})})]})},u=s(e=>t=>(0,n.jsx)(d,{BlockEdit:e,props:t}),"withGenerateAltTextButton");wp.hooks.addFilter("editor.BlockEdit","ai-alt-text-generator/with-generate-alt-text-button",u)}();